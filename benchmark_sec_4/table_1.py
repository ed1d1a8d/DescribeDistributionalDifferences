import json
from collections import Counter

# Evaluating the top_k hypotheses by the system
TOP_K = 5

# it is a dictionary mapping from each system to 54 tasks (list)
# where each element of the list is a mapping from a description generated by the system to our manual rating
# there might be some annotation mistakes, but it is okay since this is a comparative study where the evaluator is blind to which system generated which description
manual_evaluation = json.load(open('manual_evaluation.json', 'r'))
print('Number of tasks: ', len(manual_evaluation['system 1 davinci-finetuned + re-rank']))
print('Evaluating Top %d Descriptions.' % TOP_K)

for system_name, evaluation_results in manual_evaluation.items():
    print(system_name)
    counter = dict(Counter(min([x[1] for x in d[:TOP_K]]) for d in manual_evaluation[system_name]))
    for c in 'ABCD':
        print(c, counter.get(c, 0))
    print('=======')
